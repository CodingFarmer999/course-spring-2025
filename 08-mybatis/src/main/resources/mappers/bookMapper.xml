<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.course.mapper.BookMapper">
	<select id="findBookById" resultType="com.course.model.BookDto">
		SELECT * FROM BOOK WHERE ID = #{id}
	</select>
	
	<select id="findAll2" resultType="com.course.model.BookDto">
		SELECT * FROM BOOK
	</select>
	
	<resultMap type="com.course.model.BookDto" id="bookMap">
		<result property="id" column="ID"/>
		<result property="name" column="NAME"/>
		<result property="author" column="IMG_NAME"/>
		<result property="buyDate" column="BUY_DATE"/>
		<collection property="stores" ofType="com.course.model.StoreDto">
			<id property="id" column="STOREID" />
			<result property="code" column="STORECODE" />
			<result property="name" column="STORENAME" />
		</collection>
	</resultMap>
	
	<select id="findAllInvetory" resultMap="bookMap">
		SELECT 
		B.ID,
		B.NAME,
		B.BUY_DATE,
		B.IMG_NAME,
		S.ID STOREID,
		S.CODE STORECODE,
		S.NAME STORENAME
		FROM BOOK B
		JOIN INVENTORY I ON I.BOOK_ID = B.ID
		JOIN STORE S ON S.ID = I.STORE_ID
	</select>
	
	<insert id="insertBookByXml" parameterType="bookDto"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO BOOK (
			AUTHOR, 
			NAME, 
			BUY_DATE, 
			IMG_NAME
		) VALUES (
			#{author}, 
			#{name}, 
			#{buyDate}, 
			#{imgName}
		)
	</insert>
	
	<insert id="insertInventoryByXml" parameterType="BOOKDTO">
		INSERT INTO INVENTORY (STORE_ID, BOOK_ID, QUANTITY) VALUES (#{storeId}, #{id}, #{quantity})
	</insert>
	
	<delete id="deleteBookByXml" parameterType="long">
		DELETE FROM BOOK WHERE ID = #{id}
	</delete>
	
	<update id="updateBookName">
		UPDATE BOOK SET NAME = #{name} WHERE ID = #{id}
	</update>
	
</mapper>